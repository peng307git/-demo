var shippingAddress=function(b){var a=this;a.addsuccess=b.addsuccess;a.modifysuccess=b.modifysuccess;a.typer=0;a.aim=0;a.modifyId="";a.uid="";if(b.addbtn){a.addressAdd(b.addbtn)}if(b.modifybtn){a.addressModify(b.modifybtn)}a.language=langType();$.i18n.properties({name:"address",path:"/static/i18n/",cache:true,mode:"map",language:a.language,callback:function(){a.ready()}});if(a.language=="en"){a.typer=1}else{a.typer=0}$(document).on("click",".addressflip .btninter",function(c){c.preventDefault();a.typer=1;a.changeType()});$(document).on("click",".addressflip .btnchina",function(c){c.preventDefault();a.typer=0;a.changeType()})};var protoAdd=shippingAddress.prototype;protoAdd.ready=function(){var a=this;$(document).on("click",".addressflip .bgblack",function(b){b.preventDefault();a.closeFlip()});$(document).on("click",".addressflip .countnone",function(b){b.preventDefault();a.closeFlip()});$(document).on("click",".addressflip #savebtn",function(b){b.preventDefault();a.submitData()})};protoAdd.addressAdd=function(b){var a=this;$(document).on("click",b,function(c){c.preventDefault();$(".addressflip").remove();a.aim=0;a.readyHtml()})};protoAdd.addressModify=function(b){var a=this;$(document).on("click",b,function(d){d.preventDefault();$(".addressflip").remove();var c=$(this).attr("addressid");a.aim=1;a.modifyId=c;a.getdate(c)});$(document).on("dblclick",b,function(){event.preventDefault();return false})};protoAdd.readyHtml=function(b){var f=this;var i="";if(!b){i=$.i18n.prop("address.text2")}else{i=$.i18n.prop("address.text1");if(b.country=="中国"){f.typer=0}else{f.typer=1}}var h=['<div class="addressflip">','<div class="bgblack"></div> <div  class="countmain">','<h2><span class="head_h2">'+i+'</span> <span class="countnone">X</span> </h2>','<div class="countbody">','<div class="china">',"<ul>",'<li class="lileft">'+$.i18n.prop("address.text3")+'  <a href="####" class="btninter">'+$.i18n.prop("address.text4")+"</a>","（"+$.i18n.prop("address.text5")+"）","</li>",'<li class="clearfix"><span class="textindent">'+$.i18n.prop("address.text6")+"</span>",'<input maxlength="25" type="text" placeholder="'+$.i18n.prop("address.text7")+'" class="widthinput inputname my_name" >','<span class="error" id="china-name-error"> </span>',"</li>",'<li class="clearfix">','<span class="textindent">'+$.i18n.prop("address.text8")+"</span>",'<div class="parent">','<select class="sheng" id="province" name="province" >','<option id="choosePro" value="-1">请选择您所在省份</option>',"</select>","</div>",'<div class="parent">','<select id="citys"  class="shi" name="city" >','<option id="chooseCity" value="-1">请选择您所在城市</option>',"</select>","</div>",'<div class="parent">','<select id="county"  class="diqu" name="county">','<option id="chooseCounty" value="-1">请选择您所在区/县</option>',"</select> ","</div>",'<span class="error" id="diqu-error"> </span>',"</li>",'<li class="clearfix"><span class="textindent">'+$.i18n.prop("address.text9")+"</span>",'<input type="text" class="widthinput chinaaddress" placeholder="'+$.i18n.prop("address.text10")+'"> ','<span class="error" id="addres-error"> </span>',"</li>",'<li class="clearfix"><span class="textindent">'+$.i18n.prop("address.text11")+"</span>",'<input type="text" class="widthinput chinacode NamberInput" placeholder="'+$.i18n.prop("address.text12")+'0">','<span class="error"> </span>',"</li>",'<li class="clearfix"><span class="textindent">'+$.i18n.prop("address.text13")+"</span>",'<select  class="countryCode"  id="countryCode1"></select>','<input type="text" class="inputphone NamberInput" id="chinaphone" placeholder="'+$.i18n.prop("address.text14")+'">','<span class="error" id="chinaphone-error"></span>',"</li>","</ul>","</div>",'<div class="internation">',"<ul>",'<li class="lileft">'+$.i18n.prop("address.text15")+'<a href="####" class="btnchina">'+$.i18n.prop("address.text4")+"</a>","</li>",'<li  class="clearfix"><span class="textindent">'+$.i18n.prop("address.text6")+"</span>",'<input maxlength="25" type="text" class="widthinput intername" >','<span class="error" id="intername-error"></span> ',"</li>",'<li class="clearfix"><span class="textindent">'+$.i18n.prop("address.text16")+"</span>",'<input type="text" class="widthinput interaddress"> ','<span class="error" id="interaddress-error"> </span>',"</li>",'<li class="clearfix"><span class="textindent">'+$.i18n.prop("address.text17")+"</span>",'<input type="text" class="widthinput intershi" > ','<span class="error" id="intershi-error"></span>',"</li>",'<li class="clearfix"><span class="textindent">'+$.i18n.prop("address.text18")+"</span>",'<input type="text" class="widthinput intersheng" >','<span class="error" id="intersheng-error"></span>',"</li> ",'<li  class="clearfix"><span class="textindent">'+$.i18n.prop("address.text11")+"</span>",'<input  type="text" class="widthinput intercose NamberInput" >','<span class="error" id="intercose-error"> </span>',"</li>",'<li class="clearfix"><span class="textindent">'+$.i18n.prop("address.text19")+"</span>",'<select class="countryCode" id="countryCode2" ></select>','<span class="error" id="countryCode-error"></span>',"</li>",'<li class="interright clearfix"><span class="textindent">'+$.i18n.prop("address.text13")+"</span>",'<select  class="countryCode" id="countryCode3"></select>','<input type="text"  class="inputphone NamberInput" id="interphone" placeholder="'+$.i18n.prop("address.text14")+'">','<span class="error" id="interphone-error"></span>',"</li>","</ul>","</div>",'<button class="btn" id="savebtn">'+$.i18n.prop("address.text20")+"</button>","</div>","</div>","</div>"].join("");$("body").append(h);$(".error").text("");$(document).find(".addressflip .countmain").animate({top:"50%"},300);var g=$(document).find(".addressflip .countmain #countryCode1");var a=new addressCountry({id:"#countryCode1",showId:true});var d=$(document).find(".addressflip .countmain #countryCode2");var l=new addressCountry({id:"#countryCode2",showId:false});var c=$(document).find(".addressflip .countmain #countryCode3");var j=new addressCountry({id:"#countryCode3",showId:true});var k=$(document).find(".addressflip .china ");citychange(k);k.find("#province").on("change",function(m){m.preventDefault();console.log("doProvAndCityRelation");k.find("#citys").trigger("focus");doProvAndCityRelation();doCityAndCountyRelation()});k.find("#citys").on("change",function(m){m.preventDefault();k.find("#county").trigger("focus");doCityAndCountyRelation()});k.find("#citys").on("focus",function(m){m.preventDefault();$(this).html("");doProvAndCityRelation()});k.find("#county").on("focus",function(m){m.preventDefault();$(this).html("");doCityAndCountyRelation()});f.changeType();if(b){$(document).find(".addressflip .lileft").hide();f.ModifyUpdate(b)}$("#countryCode2").change(function(n){var m=$(this).val();if(m==86){$("#countryCode-error").html($.i18n.prop("address.text15")+'<a href="####" class="btnchina">'+$.i18n.prop("address.text4")+"</a>")}else{$("#countryCode-error").html("")}});ifblur(".intername",$.i18n.prop("address.text21"));ifblur(".interaddress",$.i18n.prop("address.text10"));ifblur("#interphone",$.i18n.prop("address.text23"));ifblur(".intershi",$.i18n.prop("address.text24"));ifblur(".intersheng",$.i18n.prop("address.text24"));ifblur(".intercose",$.i18n.prop("address.text25"));ifblur(".inputname",$.i18n.prop("address.text21"));ifblur(".chinaaddress",$.i18n.prop("address.text22"));ifblur("#chinaphone",$.i18n.prop("address.text23"))};protoAdd.getdate=function(b){var a=this;$.ajax({url:"/user/defaultAddress",type:"GET",data:{addressId:b},success:function(d){var c=d.data;a.readyHtml(c)}})};protoAdd.ModifyUpdate=function(l){var m=this;var p=l.name;var a=l.detailedAddress;var n=l.phone;var g=l.province;var c=l.city;var o=l.area;var k=l.country;var i=l.countryCode;var h=l.phoneCode;m.uid=l.uid;var d=l.postCode;var f=l.provinceCode;var j=l.cityCode;var b=l.areaCode;if(d==null||d==0||d==""){d="000000"}if(k=="中国"){$(".my_name").val(p);$(".chinaaddress").val(a);$("#chinaphone").val(n);$("#countryCode1").val(h);$(".sheng").val(f);$(".shi").html("<option id='chooseCitymy_1' value="+j+">"+c+"</option>");$(".diqu").html("<option id='chooseCountymy' value="+b+">"+o+"</option>");$(".chinacode").val(d)}else{$("#countryCode2").val(i);$("#countryCode3").val(h);$(".intername").val(p);$(".interaddress").val(a);$(".intershi").val(c);$(".intersheng").val(g);$(".intercose").val(d);$("#interphone").val(n)}};protoAdd.changeType=function(){var a=this;if(a.typer==1){$(document).find(".addressflip .china").hide();$(document).find(".addressflip .internation").show()}else{if(a.typer==0){$(document).find(".addressflip .china").show();$(document).find(".addressflip .internation").hide()}}};protoAdd.closeFlip=function(){$(document).find(".addressflip .countmain").animate({top:"120%"},300,function(){$(".addressflip").remove()})};protoAdd.submitData=function(){var h=this;var f="";var p="";var m=" ";var s=" ";var n=" ";var d="86";var a=" ";var c=" ";var j=" ";var g="";var t=" ";var l="";var k="";if(h.typer==0){f=$.trim($(".inputname").val());p="中国";d="86";t=$.trim($(".chinacode").val());var r=$(".sheng option:selected");m=r.text();var q=$(".shi option:selected");s=q.text();var i=$(".diqu option:selected");n=i.text();var b=$.trim($(".chinaaddress").val());g=b;l=$.trim($("#countryCode1").val());k=$.trim($("#chinaphone").val());a=$(".sheng option:selected").val();c=$(".shi option:selected").val();j=$(".diqu option:selected").val();if(f==""){$("#china-name-error").text($.i18n.prop("address.text21"));return false}else{$("#china-name-error").text("")}if(r.val()=="-1"||q.val()=="-1"||i.val()=="-1"){$("#diqu-error").text($.i18n.prop("address.text26"));return false}else{$("#diqu-error").text("")}if(b==""){$("#addres-error").text($.i18n.prop("address.text22"));return false}else{$("#addres-error").text("")}if(k==""){$("#chinaphone-error").text($.i18n.prop("address.text23"));return false}else{$("#chinaphone-error").text("")}if(t==""||!t||t==0){t="000000"}}else{if(h.typer==1){f=$.trim($(".intername").val());p=$.trim($("#countryCode2 option:selected").text());d=$.trim($("#countryCode2").val());t=$.trim($(".intercose").val());var v=$.trim($(".intersheng").val());m=v;var o=$.trim($(".intershi").val());s=o;var u=$.trim($(".interaddress").val());g=u;l=$.trim($("#countryCode3").val());k=$.trim($("#interphone").val());if(f==""){$("#intername-error").text($.i18n.prop("address.text21"));return false}else{$("#intername-error").text("")}if(u==""){$("#interaddress-error").text($.i18n.prop("address.text22"));return false}else{$("#interaddress-error").text("")}if(o==""){$("#intershi-error").text($.i18n.prop("address.text24"));return false}else{$("#intershi-error").text("")}if(v==""){$("#intersheng-error").text($.i18n.prop("address.text24"));return false}else{$("#intersheng-error").text("")}if(t==""){$("#intercose-error").text($.i18n.prop("address.text25"));return false}else{$("#intercose-error").text("")}if(d=="86"){$("#countryCode-error").html($.i18n.prop("address.text15")+'<a href="####" class="btnchina">'+$.i18n.prop("address.text4")+"</a>");return false}if(k==""){$("#interphone-error").text($.i18n.prop("address.text23"));return false}else{$("#interphone-error").text("")}}}if(l=="86"&&k.length!=11){if(h.typer==1){$("#interphone-error").text($.i18n.prop("address.text27"))}else{if(h.typer==0){$("#chinaphone-error").text($.i18n.prop("address.text27"))}}return false}if(h.aim==0){$.ajax({url:"/user/userAddressAdd",type:"POST",data:{country:p,name:f,province:m,city:s,area:n,phone:k,detailedAddress:g,postCode:t,phoneCode:l,countryCode:d,provinceCode:a,cityCode:c,areaCode:j},success:function(w){if(w.status==0){h.addsuccess();h.closeFlip()}else{alertBoxFunc(w.error.message,"sure")}}})}else{if(h.aim==1){$.ajax({url:"/user/userAddressEdit",type:"POST",data:{uid:h.uid,id:h.modifyId,country:p,name:f,province:m,city:s,area:n,phone:k,detailedAddress:g,postCode:t,phoneCode:l,countryCode:d,provinceCode:a,cityCode:c,areaCode:j},success:function(w){h.modifysuccess(h.modifyId);h.closeFlip()}})}}};function ifblur(a,b){$(document).find(a).blur(function(){var c=$(this);if($.trim(c.val())==""){c.parent().find(".error").text(b);return}else{c.parent().find(".error").text("");return}})}$(document).on("keypress",".NamberInput",function(a){var b=a||e;var c=b.keyCode||b.which;if(c==46||((c>=48&&c<=57)||c==8||c==0)){return true}else{return false}});$(document).on("keyup",".NamberInput",function(a){var b=$(this).val();if(!/^\d?\d{0,20}$/.test()){$(this).val(/^\d?\d{0,20}/.exec(b))}});